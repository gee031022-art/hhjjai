<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HHJJ ÎèÑÏñ¥ÎùΩ Î≥¥Ïïà Í≤åÏûÑ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #0a0e27;
            overflow: hidden;
            color: white;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #game-ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .hud-top {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            pointer-events: auto;
        }
        
        .hud-item {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px 25px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        
        .score {
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .level {
            color: #00ddff;
            text-shadow: 0 0 10px #00ddff;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid #ff0044;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0044, #ff8844);
            transition: width 0.3s;
            box-shadow: 0 0 10px #ff0044;
        }
        
        .mission-panel {
            position: fixed;
            top: 120px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffaa00;
            border-radius: 15px;
            padding: 20px;
            max-width: 300px;
            pointer-events: auto;
            box-shadow: 0 0 30px rgba(255, 170, 0, 0.6);
        }
        
        .mission-title {
            color: #ffaa00;
            font-size: 1.3em;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 10px #ffaa00;
        }
        
        .mission-text {
            font-size: 0.95em;
            line-height: 1.6;
            color: #ddd;
        }
        
        .threat-indicator {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            pointer-events: auto;
            min-width: 180px;
            box-shadow: 0 0 40px;
        }
        
        .threat-level {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            animation: glow 2s ease-in-out infinite;
        }
        
        .threat-indicator.SAFE {
            border-color: #00ff88;
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.8);
        }
        
        .threat-indicator.SAFE .threat-level {
            color: #00ff88;
            text-shadow: 0 0 20px #00ff88;
        }
        
        .threat-indicator.CAUTION {
            border-color: #ffff00;
            box-shadow: 0 0 40px rgba(255, 255, 0, 0.8);
        }
        
        .threat-indicator.CAUTION .threat-level {
            color: #ffff00;
            text-shadow: 0 0 20px #ffff00;
        }
        
        .threat-indicator.DANGER {
            border-color: #ff8800;
            box-shadow: 0 0 40px rgba(255, 136, 0, 0.8);
        }
        
        .threat-indicator.DANGER .threat-level {
            color: #ff8800;
            text-shadow: 0 0 20px #ff8800;
        }
        
        .threat-indicator.CRITICAL {
            border-color: #ff0044;
            box-shadow: 0 0 40px rgba(255, 0, 68, 0.8);
            animation: shake 0.5s infinite;
        }
        
        .threat-indicator.CRITICAL .threat-level {
            color: #ff0044;
            text-shadow: 0 0 20px #ff0044;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            25% { transform: translateY(-50%) rotate(-2deg); }
            75% { transform: translateY(-50%) rotate(2deg); }
        }
        
        @keyframes glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .controls-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ddff;
            border-radius: 15px;
            padding: 20px;
            pointer-events: auto;
            box-shadow: 0 0 30px rgba(0, 221, 255, 0.6);
        }
        
        .control-btn {
            padding: 15px 30px;
            margin: 5px;
            border: 2px solid;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .control-btn.start {
            border-color: #00ff88;
            color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        .control-btn.start:hover {
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.8);
            transform: translateY(-3px);
        }
        
        .control-btn.reset {
            border-color: #00ddff;
            color: #00ddff;
            box-shadow: 0 0 15px rgba(0, 221, 255, 0.5);
        }
        
        .control-btn.reset:hover {
            background: rgba(0, 221, 255, 0.2);
            box-shadow: 0 0 25px rgba(0, 221, 255, 0.8);
            transform: translateY(-3px);
        }
        
        .level-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .level-btn {
            padding: 12px 20px;
            border: 2px solid;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.5);
            font-size: 0.9em;
        }
        
        .level-btn.easy {
            border-color: #00ff88;
            color: #00ff88;
        }
        
        .level-btn.medium {
            border-color: #ffff00;
            color: #ffff00;
        }
        
        .level-btn.hard {
            border-color: #ff8800;
            color: #ff8800;
        }
        
        .level-btn.expert {
            border-color: #ff0044;
            color: #ff0044;
        }
        
        .level-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px currentColor;
        }
        
        .alert-banner {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 68, 0.95);
            border: 3px solid #ff0044;
            border-radius: 15px;
            padding: 20px 40px;
            font-size: 1.5em;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 40px rgba(255, 0, 68, 0.8);
            transition: top 0.5s;
            z-index: 1000;
        }
        
        .alert-banner.show {
            top: 20px;
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }
        
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 2em;
            animation: float-up 2s ease-out forwards;
        }
        
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-100px); }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="game-ui">
        <div class="hud-top">
            <div class="hud-item">
                <div style="font-size: 0.8em; margin-bottom: 5px;">Ï†êÏàò</div>
                <div class="score" id="score">0</div>
            </div>
            
            <div class="hud-item">
                <div style="font-size: 0.8em; margin-bottom: 5px;">Î†àÎ≤®</div>
                <div class="level" id="level">1</div>
            </div>
            
            <div class="hud-item">
                <div style="font-size: 0.8em; margin-bottom: 5px;">Î≥¥Ïïà Îì±Í∏â</div>
                <div class="health-bar">
                    <div class="health-fill" id="health-bar" style="width: 100%;"></div>
                </div>
            </div>
        </div>
        
        <div class="mission-panel">
            <div class="mission-title">üéØ ÎØ∏ÏÖò</div>
            <div class="mission-text" id="mission-text">
                ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÍ≥† Ïπ®ÏûÖÏûêÎ•º Í∞êÏßÄÌïòÏÑ∏Ïöî!
            </div>
        </div>
        
        <div class="threat-indicator SAFE" id="threat-indicator">
            <div class="threat-level" id="threat-level">SAFE</div>
            <div style="font-size: 0.9em;" id="threat-time">00:00</div>
        </div>
        
        <div class="controls-panel">
            <div>
                <button class="control-btn start" onclick="toggleSimulation()">
                    <span id="play-text">‚ñ∂Ô∏è ÏãúÏûë</span>
                </button>
                <button class="control-btn reset" onclick="resetGame()">
                    üîÑ Î¶¨ÏÖã
                </button>
            </div>
            
            <div class="level-select">
                <button class="level-btn easy" onclick="selectLevel('easy')">
                    üü¢ EASY<br><small>Ï†ïÏÉÅ Î∞©Î¨∏</small>
                </button>
                <button class="level-btn medium" onclick="selectLevel('medium')">
                    üü° MEDIUM<br><small>ÏùòÏã¨ Î∞∞Ìöå</small>
                </button>
                <button class="level-btn hard" onclick="selectLevel('hard')">
                    üü† HARD<br><small>Ïπ®ÏûÖ ÏãúÎèÑ</small>
                </button>
                <button class="level-btn expert" onclick="selectLevel('expert')">
                    üî¥ EXPERT<br><small>Í∞ïÏ†ú ÌååÏÜê</small>
                </button>
            </div>
        </div>
    </div>
    
    <div class="alert-banner" id="alert-banner">üö® Ïπ®ÏûÖ Í∞êÏßÄ! üö®</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Í≤åÏûÑ ÏÉÅÌÉú
        let gameState = {
            score: 0,
            level: 1,
            health: 100,
            currentDifficulty: null,
            isPlaying: false,
            elapsedTime: 0
        };
        
        // Three.js Í∏∞Î≥∏
        let scene, camera, renderer, door, person, sensors, doorLock;
        let particles = [];
        
        // ÏÑºÏÑú Îç∞Ïù¥ÌÑ∞
        let sensorData = {
            distance: 300,
            dwellTime: 0,
            vibration: 0,
            audio: 40,
            powerNormal: true,
            housingOpen: false
        };
        
        let simulationInterval = null;
        
        // Ïî¨ Ï¥àÍ∏∞Ìôî
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0e27);
            scene.fog = new THREE.Fog(0x0a0e27, 10, 50);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(3, 2, 8);
            camera.lookAt(0, 2, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Ï°∞Î™Ö
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);
            
            const spotLight = new THREE.SpotLight(0xffffff, 1);
            spotLight.position.set(0, 10, 5);
            spotLight.castShadow = true;
            scene.add(spotLight);
            
            // Ìè¨Ïù∏Ìä∏ ÎùºÏù¥Ìä∏ (ÎèÑÏñ¥ÎùΩ)
            const doorLight = new THREE.PointLight(0x00ff88, 1, 10);
            doorLight.position.set(0.6, 1.5, -2.5);
            scene.add(doorLight);
            
            // Î∞îÎã• (ÎÑ§Ïò® Í∑∏Î¶¨Îìú)
            const gridHelper = new THREE.GridHelper(20, 20, 0x00ff88, 0x003344);
            scene.add(gridHelper);
            
            // Î≤Ω
            const wallGeometry = new THREE.BoxGeometry(10, 5, 0.2);
            const wallMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a1a2e,
                metalness: 0.5,
                roughness: 0.5
            });
            const wall = new THREE.Mesh(wallGeometry, wallMaterial);
            wall.position.set(0, 2.5, -3);
            scene.add(wall);
            
            // Î¨∏ (ÎØ∏ÎûòÌòï)
            const doorGeometry = new THREE.BoxGeometry(1.5, 3, 0.1);
            const doorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x2a2a3e,
                metalness: 0.8,
                roughness: 0.2,
                emissive: 0x001122,
                emissiveIntensity: 0.3
            });
            door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, 1.5, -2.9);
            door.castShadow = true;
            scene.add(door);
            
            // ÎèÑÏñ¥ÎùΩ (Î∞úÍ¥ë)
            const lockGeometry = new THREE.BoxGeometry(0.3, 0.4, 0.15);
            const lockMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x00ff88,
                metalness: 0.9,
                roughness: 0.1,
                emissive: 0x00ff88,
                emissiveIntensity: 0.5
            });
            doorLock = new THREE.Mesh(lockGeometry, lockMaterial);
            doorLock.position.set(0.6, 1.5, -2.85);
            scene.add(doorLock);
            
            // ToF ÏÑºÏÑú (3Í∞ú, Î∞úÍ¥ë)
            sensors = new THREE.Group();
            for (let i = 0; i < 3; i++) {
                const sensorGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.1);
                const sensorMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x00ff88,
                    emissive: 0x00ff88,
                    emissiveIntensity: 1.0
                });
                const sensor = new THREE.Mesh(sensorGeometry, sensorMaterial);
                sensor.position.set((i - 1) * 0.3, 0.5, -2.8);
                sensor.rotation.x = Math.PI / 2;
                sensors.add(sensor);
            }
            scene.add(sensors);
            
            // Ïù∏Î¨º (Í≤åÏûÑ Ï∫êÎ¶≠ÌÑ∞ Ïä§ÌÉÄÏùº)
            const personGeometry = new THREE.BoxGeometry(0.6, 1.8, 0.4);
            const personMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xff0044,
                emissive: 0xff0044,
                emissiveIntensity: 0.3
            });
            person = new THREE.Mesh(personGeometry, personMaterial);
            person.position.set(0, 0.9, 5);
            person.castShadow = true;
            scene.add(person);
            
            // Î®∏Î¶¨ Ï∂îÍ∞Ä
            const headGeometry = new THREE.SphereGeometry(0.3);
            const head = new THREE.Mesh(headGeometry, personMaterial);
            head.position.set(0, 1.2, 0);
            person.add(head);
            
            // Ïπ¥Î©îÎùº ÌöåÏ†Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò
            let cameraAngle = 0;
            setInterval(() => {
                if (gameState.isPlaying) {
                    cameraAngle += 0.001;
                    camera.position.x = Math.sin(cameraAngle) * 8;
                    camera.position.z = Math.cos(cameraAngle) * 8;
                    camera.lookAt(0, 2, 0);
                }
            }, 16);
            
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // ÏÑºÏÑú Î∞úÍ¥ë Ïï†ÎãàÎ©îÏù¥ÏÖò
            sensors.children.forEach((sensor, i) => {
                sensor.material.emissiveIntensity = 0.5 + Math.sin(Date.now() * 0.003 + i * 2) * 0.5;
            });
            
            // ÏúÑÌóòÎèÑÏóê Îî∞Î•∏ Ìö®Í≥º
            const threat = getThreatLevel();
            
            if (threat === 'SAFE') {
                doorLock.material.color.setHex(0x00ff88);
                doorLock.material.emissive.setHex(0x00ff88);
                doorLock.material.emissiveIntensity = 0.5;
                scene.fog.color.setHex(0x0a0e27);
            } else if (threat === 'CAUTION') {
                doorLock.material.color.setHex(0xffff00);
                doorLock.material.emissive.setHex(0xffff00);
                doorLock.material.emissiveIntensity = 0.7;
                scene.fog.color.setHex(0x1a1a0e);
            } else if (threat === 'DANGER') {
                doorLock.material.color.setHex(0xff8800);
                doorLock.material.emissive.setHex(0xff8800);
                doorLock.material.emissiveIntensity = 0.9;
                scene.fog.color.setHex(0x1a0e0e);
                door.rotation.y = Math.sin(Date.now() * 0.01) * 0.05;
            } else if (threat === 'CRITICAL') {
                doorLock.material.color.setHex(0xff0044);
                doorLock.material.emissive.setHex(0xff0044);
                doorLock.material.emissiveIntensity = 1.5;
                scene.fog.color.setHex(0x2a0e0e);
                door.rotation.y = Math.sin(Date.now() * 0.02) * 0.1;
                doorLock.position.x = 0.6 + Math.sin(Date.now() * 0.05) * 0.1;
                person.material.emissiveIntensity = 0.5 + Math.sin(Date.now() * 0.01) * 0.5;
            }
            
            renderer.render(scene, camera);
        }
        
        // ÏúÑÌòë Î†àÎ≤® Í≥ÑÏÇ∞
        function getThreatLevel() {
            let d = (300 - sensorData.distance) / 300;
            let t = Math.min(sensorData.dwellTime / 300, 1);
            let v = Math.min(sensorData.vibration / 10, 1);
            let score = d * 0.4 + t * 0.3 + v * 0.3;
            
            if (score < 0.3) return 'SAFE';
            if (score < 0.6) return 'CAUTION';
            if (score < 0.85) return 'DANGER';
            return 'CRITICAL';
        }
        
        // ÎÇúÏù¥ÎèÑÎ≥Ñ ÏãúÎÇòÎ¶¨Ïò§
        const levels = {
            easy: {
                name: 'Ï†ïÏÉÅ Î∞©Î¨∏Ïûê',
                mission: 'Ï†ïÏÉÅ Î∞©Î¨∏ÏûêÎ•º ÏãùÎ≥ÑÌïòÏÑ∏Ïöî. ÎèÑÏñ¥Î≤®ÏùÑ ÎàÑÎ•¥Î©¥ ÏïàÏ†ÑÌï©ÎãàÎã§.',
                duration: 40,
                scoreMultiplier: 1,
                update: (t) => {
                    if (t < 5) {
                        person.position.z = 5 - t * 0.9;
                        sensorData.distance = 200 - t * 30;
                    } else if (t < 30) {
                        person.position.z = 0.5;
                        sensorData.distance = 50;
                    } else {
                        person.position.z = 0.5 + (t - 30) * 0.45;
                        sensorData.distance = 50 + (t - 30) * 25;
                    }
                    sensorData.dwellTime = t;
                    sensorData.audio = t === 10 ? 70 : 40;
                    
                    if (t === 10) {
                        playSound('bell');
                        addScore(50);
                    }
                }
            },
            medium: {
                name: 'ÏùòÏã¨Ïä§Îü¨Ïö¥ Î∞∞Ìöå',
                mission: 'Î∞∞ÌöåÌïòÎäî Ïù∏Î¨ºÏùÑ Í∞êÏßÄÌïòÏÑ∏Ïöî. 90Ï¥à Ïù¥ÏÉÅ Ï≤¥Î•ò Ïãú ÏúÑÌóò!',
                duration: 120,
                scoreMultiplier: 2,
                update: (t) => {
                    person.position.z = 0.5 + Math.sin(t * 0.1) * 0.3;
                    person.position.x = Math.sin(t * 0.05) * 0.5;
                    person.rotation.y = Math.sin(t * 0.1) * 0.3;
                    sensorData.distance = 50 + Math.random() * 20;
                    sensorData.dwellTime = t;
                    
                    if (t === 30 || t === 60 || t === 90) {
                        addScore(100 * gameState.level);
                    }
                }
            },
            hard: {
                name: 'Ïπ®ÏûÖ ÏãúÎèÑ',
                mission: 'Ïπ®ÏûÖÏûêÎ•º ÎßâÏúºÏÑ∏Ïöî! ÎìúÎ¶¥ÏùåÍ≥º ÏßÑÎèôÏùÑ Í∞êÏßÄÌï¥Ïïº Ìï©ÎãàÎã§.',
                duration: 180,
                scoreMultiplier: 3,
                update: (t) => {
                    person.position.z = 0.3;
                    sensorData.distance = 50;
                    sensorData.dwellTime = t;
                    
                    if (t > 90) {
                        sensorData.vibration = 3 + Math.random() * 2;
                        sensorData.audio = 85 + Math.random() * 10;
                        door.rotation.y = Math.sin(t * 0.3) * 0.08;
                        person.position.z = 0.1 + Math.sin(t * 0.5) * 0.15;
                        
                        if (t === 91) {
                            playSound('drill');
                            addScore(200 * gameState.level);
                            damageHealth(5);
                        }
                    }
                }
            },
            expert: {
                name: 'Í∞ïÏ†ú ÌååÏÜê',
                mission: 'Í∏¥Í∏â! ÎèÑÏñ¥ÎùΩ ÌååÍ¥¥ ÏãúÎèÑÎ•º ÎßâÏúºÏÑ∏Ïöî! ÏûêÎèô Ïã†Í≥† ÌïÑÏöî!',
                duration: 200,
                scoreMultiplier: 5,
                update: (t) => {
                    person.position.z = 0.1;
                    sensorData.distance = 30;
                    sensorData.dwellTime = t;
                    
                    if (t > 120) {
                        sensorData.vibration = 5 + Math.random() * 3;
                        sensorData.audio = 90 + Math.random() * 10;
                        door.rotation.y = Math.sin(t * 0.5) * 0.15;
                        person.position.z = Math.sin(t * 0.8) * 0.1;
                        damageHealth(0.5);
                    }
                    
                    if (t > 150) {
                        sensorData.housingOpen = true;
                        doorLock.scale.x = 1.2 + Math.sin(t * 0.1) * 0.1;
                        
                        if (t === 151) {
                            playSound('alarm');
                            showAlert();
                            addScore(500 * gameState.level);
                        }
                    }
                    
                    if (t > 180) {
                        sensorData.powerNormal = false;
                        scene.background = new THREE.Color(0x2a0000);
                    }
                }
            }
        };
        
        // Í≤åÏûÑ Î°úÏßÅ
        function selectLevel(difficulty) {
            gameState.currentDifficulty = difficulty;
            document.getElementById('mission-text').textContent = levels[difficulty].mission;
            createParticle('üéØ', window.innerWidth / 2, window.innerHeight / 2);
        }
        
        function toggleSimulation() {
            if (!gameState.currentDifficulty) {
                alert('ÎÇúÏù¥ÎèÑÎ•º Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!');
                return;
            }
            
            if (gameState.isPlaying) {
                pauseSimulation();
            } else {
                startSimulation();
            }
        }
        
        function startSimulation() {
            gameState.isPlaying = true;
            gameState.elapsedTime = 0;
            document.getElementById('play-text').textContent = '‚è∏Ô∏è ÏùºÏãúÏ†ïÏßÄ';
            
            const level = levels[gameState.currentDifficulty];
            
            simulationInterval = setInterval(() => {
                gameState.elapsedTime++;
                
                if (gameState.elapsedTime <= level.duration) {
                    level.update(gameState.elapsedTime);
                    updateUI();
                    
                    // ÏûêÎèô Ï†êÏàò Ï¶ùÍ∞Ä
                    if (gameState.elapsedTime % 5 === 0) {
                        addScore(10 * level.scoreMultiplier);
                    }
                } else {
                    completeLevel();
                }
            }, 1000);
        }
        
        function pauseSimulation() {
            gameState.isPlaying = false;
            clearInterval(simulationInterval);
            document.getElementById('play-text').textContent = '‚ñ∂Ô∏è Ïû¨Í∞ú';
        }
        
        function completeLevel() {
            pauseSimulation();
            gameState.level++;
            addScore(1000 * gameState.level);
            createParticle('üéâ', window.innerWidth / 2, 200);
            alert(`Î†àÎ≤® ${gameState.level - 1} ÏôÑÎ£å! Î≥¥ÎÑàÏä§: ${1000 * gameState.level}Ï†ê`);
            resetSimulation();
        }
        
        function resetGame() {
            pauseSimulation();
            gameState = { score: 0, level: 1, health: 100, currentDifficulty: null, isPlaying: false, elapsedTime: 0 };
            resetSimulation();
            updateUI();
            createParticle('üîÑ', window.innerWidth / 2, window.innerHeight / 2);
        }
        
        function resetSimulation() {
            gameState.elapsedTime = 0;
            sensorData = { distance: 300, dwellTime: 0, vibration: 0, audio: 40, powerNormal: true, housingOpen: false };
            person.position.set(0, 0.9, 5);
            person.rotation.y = 0;
            door.rotation.y = 0;
            doorLock.scale.set(1, 1, 1);
            doorLock.position.x = 0.6;
            scene.background = new THREE.Color(0x0a0e27);
        }
        
        function addScore(points) {
            gameState.score += points;
            createParticle(`+${points}`, window.innerWidth * 0.15, 80);
        }
        
        function damageHealth(amount) {
            gameState.health = Math.max(0, gameState.health - amount);
            if (gameState.health === 0) {
                alert('Î≥¥Ïïà ÏãúÏä§ÌÖú Î∂ïÍ¥¥! Í≤åÏûÑ Ïò§Î≤Ñ');
                resetGame();
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('health-bar').style.width = gameState.health + '%';
            
            const threat = getThreatLevel();
            const indicator = document.getElementById('threat-indicator');
            indicator.className = 'threat-indicator ' + threat;
            document.getElementById('threat-level').textContent = threat;
            
            const minutes = Math.floor(gameState.elapsedTime / 60);
            const seconds = gameState.elapsedTime % 60;
            document.getElementById('threat-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function showAlert() {
            const banner = document.getElementById('alert-banner');
            banner.classList.add('show');
            setTimeout(() => banner.classList.remove('show'), 3000);
        }
        
        function createParticle(emoji, x, y) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = emoji;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 2000);
        }
        
        function playSound(type) {
            // Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑúÎäî Ïò§ÎîîÏò§ ÌååÏùº ÏÇ¨Ïö©
            console.log('üîä Sound:', type);
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        initScene();
    </script>
</body>
</html>
